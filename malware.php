<?php
session_start();

function isProcessRunning($pid)
{
    return file_exists("/proc/$pid");
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (isset($_POST['malwareFamily'])) {
        $malwareFamily = escapeshellarg($_POST['malwareFamily']);

        $command = "python3 /var/www/html/your_script.py $malwareFamily > /dev/null 2>&1 & echo $!";
        $pid = shell_exec($command);
        $_SESSION['pid'] = trim($pid);
        $_SESSION['status'] = 'Récupération en cours';

        echo json_encode(['status' => $_SESSION['status']]);
        exit();
    }

    if (isset($_POST['checkStatus']) && isset($_SESSION['pid'])) {
        if (isProcessRunning($_SESSION['pid'])) {
            $_SESSION['status'] = 'Récupération en cours';
        } else {
            $_SESSION['status'] = 'Terminé';
            unset($_SESSION['pid']);
        }

        echo json_encode(['status' => $_SESSION['status']]);
        exit();
    }
}
?>





<!DOCTYPE html>
<html>
<head>
    <title>Malware Downloader</title>
    <style>
        #message {
            color: orange;
        }
        
        
        body {
    background-color: white;
    font-family: Arial, sans-serif;
}

.nav-bar {
    background-color: orange;
    height: 100vh;
    width: 200px;
    position: fixed;
    left: 0;
    top: 0;
}

.nav-bar ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.nav-bar ul li {
    padding: 10px;
}

.nav-bar ul li a {
    color: white;
    text-decoration: none;
}

.content {
    margin-left: 220px;
    padding: 20px;
}

.btn {
    background-color: orange;
    color: white;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    text-align: center;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    transition-duration: 0.4s;
}

.btn:hover {
    background-color: darkorange;
    color: white;
}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $('#myForm').on('submit', function(e) {
                e.preventDefault();

                $.post('malware.php', {malwareFamily: $('[name="malwareFamily"]').val()}, function(data) {
                    $('#message').text(data.status);
                    if(data.status === 'Terminé') {
                        $('#message').css('color', 'green');
                    } else {
                        $('#message').css('color', 'orange');
                    }
                    pollForCompletion();
                }, 'json');
            });

            function pollForCompletion() {
                $.post('malware.php', {checkStatus: true}, function(data) {
                    $('#message').text(data.status);
                    if(data.status === 'Terminé') {
                        $('#message').css('color', 'green');
                    } else {
                        $('#message').css('color', 'orange');
                    }
                    if (data.status === 'Récupération en cours') {
                        setTimeout(pollForCompletion, 5000);
                    }
                }, 'json');
            }
        });
    </script>
</head>
<body>
    <h1>Malware Downloader</h1>
    <form id="myForm" method="post">
        <input type="text" name="malwareFamily" placeholder="Enter Malware Family">
        <input type="submit" name="submit" value="Execute">
    </form>
    <p id="message"></p>
</body>
</html>

